version: 2

models:
  - name: fact_payments
    description: "Payments fact table. Each row represents a separate payment transaction (e.g., voucher, card)."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - payment_sequential

    columns:
      - name: order_id
        description: "Order identifier. Can be repeated (split payments)."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('fact_orders')
              field: order_id

      - name: payment_type_key
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_payment_type')
              field: payment_type_key

      - name: payment_date_key
        description: "Payment date key (linked to the purchase date)."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key

      - name: payment_sequential
        description: "Payment sequential number (e.g., 1, 2 for combined payments)."
        tests:
          - not_null

      - name: payment_value
        description: "Payment amount for this specific transaction."
        tests:
          - not_null

      - name: payment_installments
        description: "Number of installments chosen by the customer."
        tests:
          - not_null