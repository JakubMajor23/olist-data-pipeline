version: 2

models:
  - name: fact_sales_items
    description: "Order items fact table. Contains product and seller details. Dates are analyzed through the relationship to fact_orders."
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - order_id
            - order_item_id

    columns:
      - name: order_id
        description: "Order identifier. Foreign key to the fact_orders table."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('fact_orders')
              field: order_id

      - name: order_item_id
        description: "Sequential number of the item within the order."
        tests:
          - not_null

      - name: product_key
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_products')
              field: product_key

      - name: seller_key
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_sellers')
              field: seller_key

      - name: price
        description: "Unit price of the product (excluding shipping costs)."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: freight_value
        description: "Unit shipping cost."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0