version: 2

models:
  - name: dim_products
    description: "Product dimension table (SCD Type 1). Contains one unique row per product, based on stg__products."
    tests:
      - dbt_utils.equal_rowcount:
          compare_model: ref('stg__products')

    columns:
      - name: product_key
        description: "Surrogate primary key for the product dimension, generated as an MD5 hash of product_id."
        tests:
          - unique
          - not_null

      - name: product_id
        description: "Natural key (business key) from the source system."
        tests:
          - unique
          - not_null


      - name: product_category_name_english
        description: "Product category name in English. 'unknown' if NULL in source."
        tests:
          - not_null

      - name: product_name_length
        description: "Length of the product name. 0 if NULL in source."
        tests: &non_negative_test
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: product_description_length
        description: "Length of the product description. 0 if NULL in source."
        tests: *non_negative_test

      - name: product_photos_qty
        description: "Number of photos for the product. 0 if NULL in source."
        tests: *non_negative_test

      - name: product_weight_g
        description: "The product's weight in grams."
        tests: *non_negative_test

      - name: product_length_cm
        description: "The product's length in centimeters."
        tests: *non_negative_test

      - name: product_height_cm
        description: "The product's height in centimeters."
        tests: *non_negative_test

      - name: product_width_cm
        description: "The product's width in centimeters."
        tests: *non_negative_test