version: 2

models:
  - name: fact_orders
    description: "Orders fact table (header level). Contains logistics, statuses, and references to customers."
    columns:
      - name: order_id
        description: "Unique order identifier."
        tests:
          - unique
          - not_null

      - name: customer_key
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_customer')
              field: customer_key

      - name: order_status_key
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_order_status')
              field: order_status_key

      - name: review_key
        description: "Key to the order review content."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_review')
              field: review_key

      
      - name: order_purchase_timestamp_key
        description: "Order purchase date."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key

      - name: order_approved_at_key
        description: "Payment approval date."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key

      - name: order_delivered_customer_date_key
        description: "Customer delivery date."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key

      - name: order_estimated_delivery_date_key
        description: "Estimated delivery date."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key

      - name: review_creation_date_key
        description: "Review creation date (survey)."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key

      - name: review_answer_date_key
        description: "Survey answer date."
        tests:
          - not_null
          - relationships:
              arguments:
              to: ref('dim_date')
              field: data_key


      - name: total_order_value
        description: "Total order value (price + freight_value)."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: total_item_value
        description: "Total product value in the order."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: total_freight_value
        description: "Total shipping cost in the order."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
  
      - name: review_score
        description: "Numerical order rating (e.g., 1-5)."
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 5  